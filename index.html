<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Year Progress Tracker with Weather and Stock</title>
    <link rel="stylesheet" href="./css/main.css">
    <link rel="icon" href="./resources/icon.png" type="image/png">
</head>
<body>
    <header>
        <div id="icon">
            <img src="./resources/icon.png" alt="Year Progress Icon" id="icon">
        </div>
        <div>
            <a href="https://www.youtube.com/shorts/CJQ52rVHRmI" target="_blank">Click me! ðŸ¦…ðŸ˜ª</a>
            <button id="theme-toggle">ðŸŒ“</button>
        </div>
    </header>
    <div class="container">
        <h1>Year Progress</h1>
        <div id="progress-bar">
            <div id="progress"></div>
            <div id="progress-glow"></div>
        </div>
        <p id="percentage"></p>
        <p id="days-left"></p>
        <div class="time-breakdown">
            <div class="time-item">
                <div class="time-value" id="months"></div>
                <div class="time-label">Months</div>
            </div>
            <div class="time-item">
                <div class="time-value" id="weeks"></div>
                <div class="time-label">Weeks</div>
            </div>
            <div class="time-item">
                <div class="time-value" id="days"></div>
                <div class="time-label">Days</div>
            </div>
        </div>
        <p id="mood"></p>
        <div id="stock">
            <h2>
                Renault Stock
                <svg width="21" height="28" viewBox="0 0 21 28" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M16.8049 14.0105L9.46458 27.9859H7.36942L0.0339355 14.0105L7.36942 0.0351562H9.46458L2.13394 14.0105L8.41942 25.9894L14.7049 14.0105L11.0372 7.0253L12.0872 5.02882L16.8049 14.0105ZM13.6597 0.0351562H11.5646L4.2291 14.0105L8.94684 22.9922L9.99684 20.9957L6.3291 14.0056L12.6146 2.02671L18.9001 14.0056L11.5646 27.9859H13.6597L20.9952 14.0105L13.6597 0.0351562Z" fill="white"></path>
                </svg>
            </h2>
            <p id="stock-price"></p>
            <p id="stock-change"></p>
        </div>
    </div>

    <script>
        function updateProgress() {
            const now = new Date();
            const start = new Date(now.getFullYear(), 0, 1);
            const end = new Date(now.getFullYear() + 1, 0, 1);
            const progress = (now - start) / (end - start);
            const percentage = (progress * 100).toFixed(2);

            document.getElementById('progress').style.width = `${percentage}%`;
            document.getElementById('progress-glow').style.width = `${percentage}%`;
            document.getElementById('percentage').textContent = `${percentage}% of the year has passed`;

            const timeLeft = end - now;
            const daysLeft = Math.ceil(timeLeft / (1000 * 60 * 60 * 24));
            document.getElementById('days-left').textContent = `${daysLeft} days left in the year`;

            document.getElementById('months').textContent = Math.floor(daysLeft / 30);
            document.getElementById('weeks').textContent = Math.floor(daysLeft / 7);
            document.getElementById('days').textContent = daysLeft;

            updateMood(percentage);
            updateBackground(percentage);
        }

        function updateMood(percentage) {
            let mood;
            if (percentage < 25) {
                mood = "The year is young, full of possibilities!";
            } else if (percentage < 50) {
                mood = "Time's flying, but there's still so much to do!";
            } else if (percentage < 75) {
                mood = "More than halfway there, keep pushing!";
            } else {
                mood = "The year's almost over, finish strong!";
            }
            document.getElementById('mood').textContent = mood;
        }

        function updateBackground(percentage) {
            const hue = Math.floor(percentage * 3.6); // 0-360
            document.body.style.backgroundColor = `hsl(${hue}, 30%, 15%)`;
        }

        let isDarkTheme = true;
        function toggleTheme() {
            isDarkTheme = !isDarkTheme;
            if (isDarkTheme) {
                document.body.style.color = 'white';
                document.querySelector('.container').style.background = 'rgba(255, 255, 255, 0.1)';
                document.querySelector('path').setAttribute('fill', 'white');
            } else {
                document.body.style.color = 'black';
                document.querySelector('.container').style.background = 'rgba(0, 0, 0, 0.1)';
                document.querySelector('path').setAttribute('fill', 'black');
            }

            const button = document.getElementById('theme-toggle');
            button.classList.add('rotate');
            setTimeout(() => button.classList.remove('rotate'), 500);
        }

        function getStockData() {
            const url = `https://ypa.komstaproductionstudio.com/`;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    const price = data['price'];
                    const change = data['change'];
                    const changePercent = data['changePercent'];
                    const symbol = data['symbol'];

                    document.getElementById('stock-price').textContent = `${price} â‚¬`;
                    const changeElement = document.getElementById('stock-change');
                    changeElement.textContent = `${change} (${changePercent})`;
                    changeElement.className = 'stock-change ' + (change >= 0 ? 'positive' : 'negative');
                })
                .catch(error => {
                    console.error('Error fetching stock data:', error);
                    //document.getElementById('stock').innerHTML = '<p>Failed to load stock data</p>';
                });
        }

        document.getElementById('theme-toggle').addEventListener('click', toggleTheme);

        updateProgress();
        setInterval(updateProgress, 60000); // Update every minute
        getStockData(); // Get stock data on page load
        setInterval(getStockData, 300000); // Update stock data every 5 minutes
    </script>
</body>
</html>
